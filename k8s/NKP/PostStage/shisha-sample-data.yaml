apiVersion: batch/v1
kind: Job
metadata:
  name: shisha-sample-data
  namespace: shisha
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: seed
          image: curlimages/curl:8.2.1
          command:
            - /bin/sh
            - -c
            - |
              set -eu
              echo "Lade Seed-Daten herunter …"
              curl -fsSL https://raw.githubusercontent.com/str33tr4z0r/shisha-tracker-nextgen/refs/heads/main/scripts/tabak.jsonl -o /tmp/shisha

              echo "Sende Daten an Backend API …"
              while IFS= read -r line; do
                [ -z "$line" ] && continue
                echo "POST /api/shishas: $line"
                curl -sS -X POST http://shisha-backend-mock:8080/api/shishas \
                  -H "Content-Type: application/json" \
                  -d "$line" \
                  || echo "POST failed for: $line"
              done < /tmp/shisha

              echo "Alle Datensätze verarbeitet."
      serviceAccountName: default
